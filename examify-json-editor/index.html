<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examify JSON Editor</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- CodeMirror CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/dracula.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/lint/lint.min.css">
    <!-- Toastify CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css" rel="stylesheet">
    <!-- KaTeX CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/katex/0.16.9/katex.min.css" rel="stylesheet">
    <!-- Prism.js CSS (Okaidia theme for code highlighting in preview) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-edit me-2"></i>Examify JSON Editor
            </a>
            <div class="ms-auto d-flex">
                <button class="btn btn-light btn-sm ms-2" id="importBtnTrigger" title="Import JSON from file or text">
                    <i class="fas fa-upload me-1"></i> Import
                </button>
                <button class="btn btn-light btn-sm ms-2" id="exportBtnTrigger" title="Export current JSON to a file">
                    <i class="fas fa-download me-1"></i> Export
                </button>
                <button class="btn btn-light btn-sm ms-2" id="validateGlobalBtn" title="Validate the current JSON data">
                    <i class="fas fa-check-circle me-1"></i> Validate All
                </button>
                 <button class="btn btn-light btn-sm ms-2" type="button" data-bs-toggle="modal" data-bs-target="#helpModal" title="Open detailed help guide">
                    <i class="fas fa-question-circle"></i> Help
                </button>
            </div>
        </div>
    </nav>

    <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-chevron-left" id="toggleIcon"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5 class="mb-0">Tools & Templates</h5>
        </div>
        <div class="sidebar-content">
            <ul class="nav nav-tabs" id="sidebarTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templates-content" type="button" role="tab">Templates</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="help-sidebar-tab-button" data-bs-toggle="tab" data-bs-target="#help-content-sidebar" type="button" role="tab">Quick Help</button>
                </li>
            </ul>
            <div class="tab-content" id="sidebarTabContent">
                <!-- Templates Tab -->
                <div class="tab-pane fade show active" id="templates-content" role="tabpanel">
                    <div class="mb-3">
                        <label for="templateCategory" class="form-label">Select Template Category</label>
                        <select class="form-select form-select-sm" id="templateCategory">
                            <option value="basic">Basic Templates</option>
                            <option value="subjects">Subject-specific Templates</option>
                            <option value="complex">Complex Content Templates</option>
                        </select>
                    </div>
                    <div class="json-templates" id="templatesList">
                        <!-- Templates will be dynamically added here -->
                        <div class="spinner-container" id="templatesLoading" style="display:none;">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Help Tab (Simplified version of main help modal content) -->
                <div class="tab-pane fade" id="help-content-sidebar" role="tabpanel">
                    <div class="accordion" id="helpAccordionSidebar">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRequiredSidebar" aria-expanded="true">
                                    Required Fields
                                </button>
                            </h2>
                            <div id="collapseRequiredSidebar" class="accordion-collapse collapse show" data-bs-parent="#helpAccordionSidebar">
                                <div class="accordion-body small">
                                    <code>question_number</code>, <code>question_text</code>, <code>options</code>, <code>correct_answer</code>. Min 2 options.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRichContentSidebar">
                                    Rich Content
                                </button>
                            </h2>
                            <div id="collapseRichContentSidebar" class="accordion-collapse collapse" data-bs-parent="#helpAccordionSidebar">
                                <div class="accordion-body small">
                                    <strong>Math:</strong> <code>$...$</code> or <code>$$...$$</code> (LaTeX)<br>
                                    <strong>Images:</strong> <code>![alt](URL or path)</code><br>
                                    <strong>Code:</strong> <code>```lang ... ```</code><br>
                                    <small>Paths like <code>NIMCET/assets/img.png</code> resolve from GitHub repo.</small>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseJSONEscapingSidebar">
                                    Raw JSON Escaping
                                </button>
                            </h2>
                            <div id="collapseJSONEscapingSidebar" class="accordion-collapse collapse" data-bs-parent="#helpAccordionSidebar">
                                <div class="accordion-body small">
                                    When editing Raw JSON:<br>
                                    LaTeX <code>\</code> → <code>\\</code> (e.g., <code>"$\\frac{a}{b}$"</code>)<br>
                                    Code newlines → <code>\\n</code>
                                </div>
                            </div>
                        </div>
                         <div class="text-center mt-3">
                            <button class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#helpModal">
                                <i class="fas fa-book-open me-1"></i> Open Full Guide
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid">
            <!-- Main Tab Navigation -->
            <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#form-tab-content" type="button" role="tab">
                        <i class="fas fa-edit me-1"></i> Form Editor
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="json-tab" data-bs-toggle="tab" data-bs-target="#json-tab-content" type="button" role="tab">
                        <i class="fas fa-code me-1"></i> JSON Editor
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview-tab-content" type="button" role="tab">
                        <i class="fas fa-eye me-1"></i> Preview
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Form Editor Tab -->
                <div class="tab-pane fade show active" id="form-tab-content" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-8 col-md-12">
                            <!-- Question List -->
                            <div class="card mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Question List</h5>
                                    <button class="btn btn-primary btn-sm" id="addQuestionBtn" title="Add a new question">
                                        <i class="fas fa-plus me-1"></i> Add Question
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="accordion" id="questionsAccordion">
                                        <div class="alert alert-info text-center m-0" id="noQuestionsAlert">
                                            <i class="fas fa-info-circle me-2"></i> No questions yet. Click "Add Question" to get started or import a JSON file.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <!-- JSON Status -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Status & Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="status-badge me-2" id="jsonStatus">
                                            <i class="fas fa-circle"></i> Ready
                                        </div>
                                        <div class="flex-grow-1">
                                            <span id="questionCount">0 questions</span>
                                        </div>
                                    </div>
                                    <div class="error-message small" id="validationErrorMessage" style="display: none;">
                                        <div class="mb-1"><strong>Validation Issues:</strong></div>
                                        <div id="validationErrorText"></div>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success btn-sm" id="validateFormBtn" title="Validate data from Form Editor">
                                            <i class="fas fa-check-circle me-1"></i> Validate Form Data
                                        </button>
                                        <button class="btn btn-info btn-sm" id="syncToJsonBtn" title="Update JSON Editor with current Form data">
                                            <i class="fas fa-sync me-1"></i> Sync to JSON Editor
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Help / Tips (Moved detailed help to sidebar tab & main modal) -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-lightbulb text-warning me-2"></i>Quick Tips</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled small">
                                        <li><i class="fas fa-check text-success me-2"></i>Use Form Editor for easy creation.</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Switch to JSON Editor for advanced edits.</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Validate regularly to catch errors.</li>
                                        <li><i class="fas fa-check text-success me-2"></i>See Preview tab for how questions look.</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Use sidebar Templates for quick starts.</li>
                                    </ul>
                                    <div class="d-grid">
                                        <button class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#helpModal">
                                            <i class="fas fa-book-open me-1"></i> Open Full Help Guide
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- JSON Editor Tab -->
                <div class="tab-pane fade" id="json-tab-content" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Raw JSON Editor</h5>
                            <div>
                                <button class="btn btn-success btn-sm me-2" id="validateJsonEditorBtn" title="Validate JSON in the editor">
                                    <i class="fas fa-check-circle me-1"></i> Validate JSON
                                </button>
                                <button class="btn btn-info btn-sm" id="syncToFormBtn" title="Update Form Editor with data from JSON (will overwrite form)">
                                    <i class="fas fa-sync me-1"></i> Sync to Form Editor
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="jsonEditorStatus" class="p-2" style="display: none;"></div>
                            <div class="json-editor-container">
                                <textarea id="jsonEditorTextarea"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Tab -->
                <div class="tab-pane fade" id="preview-tab-content" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                             <h5 class="mb-0">Live Preview</h5>
                             <button class="btn btn-primary btn-sm" id="refreshPreviewBtn" title="Refresh the preview based on current data">
                                <i class="fas fa-sync-alt me-1"></i> Refresh Preview
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning" id="previewAlert" style="display: none;">
                                <i class="fas fa-exclamation-triangle me-2"></i> 
                                <span id="previewAlertText">Please validate your JSON or ensure data is loaded before previewing.</span>
                            </div>
                            <div id="previewContainer" class="preview-container">
                                <!-- Preview content will be generated here -->
                                <div class="text-center text-muted" id="noPreviewContent">No questions to preview. Load or create questions first.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <p>© 2023-2024 Examify JSON Editor. For Examify Online Practice Platform. MIT License.</p>
        </footer>
    </div>

    <!-- Add/Edit Question Modal -->
    <div class="modal fade" id="questionModal" tabindex="-1" aria-labelledby="questionModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="questionModalTitle">Add New Question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="questionForm">
                        <input type="hidden" id="editQuestionIndex" value="-1">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="questionNumber" class="form-label required-field">Question Number</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="questionNumber" min="1" required>
                                    <span class="input-group-text">
                                        <i class="fas fa-info-circle help-tooltip" data-bs-toggle="tooltip" 
                                           title="Must be a positive integer. Should be sequential (auto-suggested for new questions) and unique."></i>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="difficulty" class="form-label">Difficulty</label>
                                <select class="form-select" id="difficulty">
                                    <option value="">Not specified</option>
                                    <option value="Easy">Easy</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Hard">Hard</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="subject" class="form-label">Subject</label>
                                <input type="text" class="form-control" id="subject" placeholder="e.g., Mathematics">
                            </div>
                            <div class="col-md-6">
                                <label for="topic" class="form-label">Topic</label>
                                <input type="text" class="form-control" id="topic" placeholder="e.g., Calculus">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="sectionId" class="form-label">Section ID</label>
                            <input type="text" class="form-control" id="sectionId" placeholder="e.g., Section A, Quant">
                        </div>

                        <div class="mb-3">
                            <label for="questionText" class="form-label required-field">Question Text</label>
                            <div class="input-group">
                                <textarea class="form-control" id="questionText" rows="4" required></textarea>
                                 <span class="input-group-text align-items-start pt-2">
                                    <i class="fas fa-info-circle help-tooltip" data-bs-toggle="tooltip" 
                                       title="Supports LaTeX (e.g., $\alpha$), Markdown images (![alt](url or path like 'ExamName/assets/image.png')), and code blocks (```lang ... ```)."></i>
                                </span>
                            </div>
                            <div class="help-text">
                                <strong>Format Tips:</strong> 
                                Inline math: <code>$...$</code>, Display math: <code>$$...$$</code>. Images: <code>![Alt](URL)</code> or <code>![Alt](RelativePath/image.png)</code>. Code: <code>```language ... ```</code>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label required-field">Options</label> <span class="help-text ms-2">(Minimum 2 options required)</span>
                            <div class="options-container" id="optionsModalContainer">
                                <!-- Options will be dynamically added here for the modal -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm add-option-btn" id="addOptionModalBtn">
                                <i class="fas fa-plus me-1"></i> Add Option
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <label for="explanation" class="form-label">Explanation</label>
                            <textarea class="form-control" id="explanation" rows="3" placeholder="Provide detailed explanation (recommended). Supports same formatting as question text."></textarea>
                            <div class="help-text">
                                (Highly Recommended) Add a detailed explanation. Supports the same rich content.
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveQuestionBtn">Save Question</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal (Full Guide) -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel"><i class="fas fa-book-reader me-2"></i>Examify JSON Editor Help Guide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="list-group sticky-top" id="help-list-tab" role="tablist" style="top: 20px;">
                                <a class="list-group-item list-group-item-action active" data-bs-toggle="list" href="#help-overview" role="tab">Overview</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-json-format" role="tab">JSON Format</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-form-editor" role="tab">Form Editor</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-json-editor-guide" role="tab">JSON Editor</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-formatting-guide" role="tab">Rich Content</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-common-errors-guide" role="tab">Common Errors</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-ai-generation-guide" role="tab">AI Generation</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-templates-guide" role="tab">Templates</a>
                                <a class="list-group-item list-group-item-action" data-bs-toggle="list" href="#help-import-export-guide" role="tab">Import/Export</a>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="help-overview" role="tabpanel">
                                    <h4>Welcome to Examify JSON Editor</h4>
                                    <p>This tool helps you create, edit, and validate JSON files for the Examify platform with ease - whether you're a technical expert or completely new to JSON.</p>
                                    
                                    <h5>Key Features</h5>
                                    <ul>
                                        <li><strong>Form-based Editor:</strong> Create questions using a simple form interface - no JSON knowledge required.</li>
                                        <li><strong>Advanced JSON Editor:</strong> Direct JSON editing with syntax highlighting and error detection via CodeMirror.</li>
                                        <li><strong>Comprehensive Validation:</strong> Instantly catch and fix formatting and structural errors based on Examify's schema.</li>
                                        <li><strong>Live Preview:</strong> See how your questions will look, including LaTeX math, Markdown images (relative paths supported), and syntax-highlighted code blocks.</li>
                                        <li><strong>Templates:</strong> Start quickly with pre-made question structures.</li>
                                        <li><strong>Import/Export:</strong> Load existing JSON files or save your work.</li>
                                    </ul>
                                    
                                    <h5>Getting Started</h5>
                                    <ol>
                                        <li><strong>Use the Form Editor:</strong> Click "Add Question" to create your first question. Fill in the fields (required fields are marked with *).</li>
                                        <li><strong>Rich Content:</strong> For math, type LaTeX like <code>$\alpha + \beta$</code> or <code>$$\sum_{i=0}^n x_i$$</code>. For images, use <code>![alt text](image_url)</code> or relative paths like <code>![My Diagram](NIMCET/assets/diagram.png)</code>. For code, use Markdown code fences: <code>```python ... ```</code>. The editor handles the necessary JSON escaping automatically.</li>
                                        <li><strong>Options:</strong> Add at least two options. Choose an "Option Key" (e.g., "a", "b", "1"). This key will be used for <code>correct_answer</code>. Enter the "Option Value" (text of the option). Rich content is supported. Select one as the correct answer.</li>
                                        <li><strong>Save & Validate:</strong> Save your question. Use the "Validate" buttons regularly to check for errors.</li>
                                        <li><strong>Preview:</strong> Switch to the "Preview" tab to see how your questions will be rendered.</li>
                                        <li><strong>Export:</strong> When finished, use the "Export" button to download your JSON file.</li>
                                    </ol>
                                </div>
                                
                                <div class="tab-pane fade" id="help-json-format" role="tabpanel">
                                    <h4>Examify Question JSON Format</h4>
                                    <p>The Examify platform expects exam questions as a JSON array of question objects. Each object must follow this structure:</p>
                                    
                                    <div class="code-block bg-light p-3 rounded">
<pre><code class="language-json">[
  {
    "question_number": 1,
    "question_text": "If $x + 5 = 12$, what is the value of $x$?",
    "options": {
      "a": "5",
      "b": "7",
      "c": "12",
      "d": "17"
    },
    "correct_answer": "b",
    
    "subject": "Mathematics",    // Optional
    "topic": "Algebra",          // Optional
    "explanation": "Subtract 5 from both sides: $x + 5 - 5 = 12 - 5 \\implies x = 7$.", // Optional
    "difficulty": "Easy",        // Optional: "Easy", "Medium", or "Hard"
    "section_id": "SectionA"     // Optional
  }
  // ... more question objects
]</code></pre>
                                    </div>
                                    
                                    <h5>Field Details</h5>
                                    <ul>
                                        <li><strong><code>question_number</code> (Required, Number):</strong> Unique positive integer, should be sequential starting from 1.</li>
                                        <li><strong><code>question_text</code> (Required, String):</strong> The main question text. Supports rich content.</li>
                                        <li><strong><code>options</code> (Required, Object):</strong> Key-value pairs.
                                            <ul>
                                                <li>Keys (String, e.g., "a", "1"): Option identifiers.</li>
                                                <li>Values (String): Option text. Supports rich content.</li>
                                                <li>Must have at least two options.</li>
                                            </ul>
                                        </li>
                                        <li><strong><code>correct_answer</code> (Required, String):</strong> The key from the <code>options</code> object that is the correct answer (e.g., "b").</li>
                                        <li><strong><code>subject</code> (Optional, String | null):</strong> Subject area (e.g., "Mathematics", "Physics"). If present and not null, must be non-empty.</li>
                                        <li><strong><code>topic</code> (Optional, String | null):</strong> Specific topic (e.g., "Calculus", "Optics"). If present and not null, must be non-empty.</li>
                                        <li><strong><code>explanation</code> (Optional, String | null):</strong> Detailed explanation. Supports rich content. Highly encouraged! If present and not null, must be a string (can be empty).</li>
                                        <li><strong><code>difficulty</code> (Optional, String | null):</strong> Difficulty level ("Easy", "Medium", "Hard"). If present and not null, must be one of these, or an empty string (representing "Not specified" from form).</li>
                                        <li><strong><code>section_id</code> (Optional, String | null):</strong> Identifier for exams with sections (e.g., "Section A"). If present and not null, must be non-empty.</li>
                                    </ul>
                                    <p class="mt-3"><strong>Important for JSON strings (<code>question_text</code>, option values, <code>explanation</code>) when editing Raw JSON:</strong>
                                        <ul>
                                            <li>For LaTeX: A command like <code>\frac</code> should appear as <code>\\frac</code> in the JSON string. Example: <code>"$\\frac{1}{2}$"</code>. (This results in the JS string <code>$\frac{1}{2}$</code> after parsing).</li>
                                            <li>For Newlines in Code: A newline character in a code block should appear as <code>\\n</code> in the JSON string. Example: <code>"Code line 1\\nCode line 2"</code>.</li>
                                        </ul>
                                    The Form Editor in this tool handles these conversions for you automatically when saving to its internal state.
                                    </p>
                                </div>
                                
                                <div class="tab-pane fade" id="help-form-editor" role="tabpanel">
                                    <h4>Using the Form Editor</h4>
                                    <p>The Form Editor provides an intuitive way to create and manage questions without writing JSON code directly.</p>
                                    
                                    <h5>Adding a New Question</h5>
                                    <ol>
                                        <li>Click the "Add Question" button. This opens the question modal.</li>
                                        <li><strong>Question Number:</strong> Auto-suggested. Ensure it's unique and positive.</li>
                                        <li><strong>Difficulty:</strong> Select from "Easy", "Medium", "Hard", or leave as "Not specified".</li>
                                        <li><strong>Subject, Topic, Section ID:</strong> Fill these optional fields as needed.</li>
                                        <li><strong>Question Text:</strong> Type your question. Use LaTeX for math (e.g., <code>$\alpha$</code>), Markdown for images (<code>![alt](url)</code> or <code>![alt](path/to/image.png)</code>), and code blocks (<code>```lang ... ```</code>).</li>
                                        <li><strong>Options:</strong>
                                            <ul>
                                                <li>Click "Add Option".</li>
                                                <li>Enter an "Option Key" (e.g., "a", "b"). This key is used for <code>correct_answer</code>.</li>
                                                <li>Enter the "Option Value" (text of the option). Rich content is supported.</li>
                                                <li>Select the radio button next to the correct option. At least two options are needed.</li>
                                            </ul>
                                        </li>
                                        <li><strong>Explanation:</strong> Provide a detailed explanation (recommended). Rich content supported.</li>
                                        <li>Click "Save Question".</li>
                                    </ol>
                                    
                                    <h5>Editing an Existing Question</h5>
                                    <p>In the "Question List", click the "Edit <i class='fas fa-pencil-alt fa-xs'></i>" button on a question. Modify and save.</p>

                                    <h5>Deleting a Question</h5>
                                    <p>Click the "Delete <i class='fas fa-trash-alt fa-xs'></i>" button on a question. Confirm deletion.</p>

                                    <h5>Status & Actions (Right Panel in Form Tab)</h5>
                                    <ul>
                                        <li><strong>JSON Status:</strong> Shows "Valid" or "Invalid".</li>
                                        <li><strong>Question Count:</strong> Number of questions.</li>
                                        <li><strong>Validation Error Message:</strong> Displays errors if validation fails.</li>
                                        <li><strong>Validate Form Data:</strong> Validates all questions from the forms.
                                        <li><strong>Sync to JSON Editor:</strong> Updates the "JSON Editor" tab with current form data.</li>
                                    </ul>
                                </div>
                                
                                <div class="tab-pane fade" id="help-json-editor-guide" role="tabpanel">
                                    <h4>Using the JSON Editor</h4>
                                    <p>The JSON Editor (CodeMirror) allows direct manipulation of raw JSON. Useful for technical users, bulk edits, or pasting JSON.</p>
                                    
                                    <h5>Features</h5>
                                    <ul>
                                        <li>Syntax Highlighting & Line Numbers.</li>
                                        <li>Basic Linting for JSON syntax errors (missing commas, quotes). Requires <code>jsonlint</code> to work correctly.</li>
                                    </ul>
                                    
                                    <h5>Editing JSON</h5>
                                    <ul>
                                        <li>Ensure the overall structure is an array <code>[ ... ]</code> of question objects <code>{ ... }</code>.</li>
                                        <li>Follow "JSON Format" rules.</li>
                                        <li><strong>Escaping for Rich Content (Crucial for Raw JSON Editing):</strong>
                                            <ul>
                                               <li><strong>LaTeX:</strong> Literal backslashes in LaTeX (e.g., in `\frac`) must be escaped with another backslash: `\\frac`. So, to get `$\frac{a}{b}$` in the application's memory, the JSON string must be `"$\\frac{a}{b}$"`.</li>
                                               <li><strong>Code Block Newlines:</strong> Literal newlines within code strings must be escaped as `\\n`. Example: `"First line\\nSecond line"`.</li>
                                               <li><strong>Double Quotes in Strings:</strong> If your text needs a literal double quote, it must be escaped as `\"`. Example: `"He said, \\"Hello\\""`.</li>
                                            </ul>
                                        </li>
                                    </ul>
                                    
                                    <h5>Actions</h5>
                                    <ul>
                                        <li><strong>Validate JSON:</strong> Validates editor content against the Examify schema.</li>
                                        <li><strong>Sync to Form Editor:</strong> Parses editor JSON. If valid, updates Form Editor. <strong>Caution: Overwrites unsynced Form Editor changes.</strong></li>
                                    </ul>
                                </div>

                                <div class="tab-pane fade" id="help-formatting-guide" role="tabpanel">
                                    <h4>Rich Content Formatting Guide</h4>
                                    <p>Examify supports rich content in <code>question_text</code>, option values, and <code>explanation</code>.
                                    When using the <strong>Form Editor</strong>, type rich content naturally. The tool handles JSON string escaping.
                                    When editing <strong>Raw JSON</strong>, you must manually ensure correct escaping for JSON strings.</p>

                                    <h5>1. Mathematical Notation (LaTeX via KaTeX)</h5>
                                    <ul>
                                        <li><strong>Form Editor Input:</strong> Type LaTeX directly, e.g., <code>$E = mc^2$</code> for inline, <code>$$\frac{a}{b}$$</code> for display.</li>
                                        <li><strong>Raw JSON String Value (how it appears in the .json file or JSON editor):</strong>
                                            <br>For <code>$\alpha + \beta$</code>, the JSON string is <code>"$\\alpha + \\beta$"</code>.
                                            <br>For <code>$$\frac{a}{b}$$</code>, the JSON string is <code>"$$\\frac{a}{b}$$"</code>.
                                            <br>(Note: The KaTeX delimiters <code>$</code> and <code>$$</code> themselves are usually *not* escaped. Only backslashes within the LaTeX command part are, e.g., <code>\frac</code> becomes <code>\\frac</code>).
                                        </li>
                                         <li><strong>Preview:</strong> Renders using KaTeX. Ensure KaTeX auto-render is working.</li>
                                    </ul>

                                    <h5>2. Images (Markdown)</h5>
                                    <ul>
                                        <li><strong>Syntax:</strong> <code>![Alt Text](Image URL or Relative Path)</code></li>
                                        <li><strong>Supported URLs:</strong>
                                            <ul>
                                                <li>Absolute HTTPS URLs: <code>https://example.com/image.png</code></li>
                                                <li>Relative paths (resolved from <a href="https://github.com/Samkarya/online-exam-questions/tree/main/" target="_blank" rel="noopener">online-exam-questions GitHub repo</a> `main` branch):
                                                    e.g., <code>NIMCET/assets/some_image.jpg</code> or <code>assets/another_image.gif</code>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>HTTP URLs are blocked for security. Local file paths (<code>file:///</code>) won't work in the web preview.</li>
                                        <li><strong>Raw JSON String Value:</strong> <code>"![Alt Text](https://example.com/image.png)"</code> or <code>"![Diagram](NIMCET/assets/circuit.png)"</code>. (Standard Markdown, no special escaping for this basic syntax itself within the JSON string).</li>
                                        <li><strong>Preview:</strong> Renders images. If a path is relative, it's prefixed with <code>https://raw.githubusercontent.com/Samkarya/online-exam-questions/main/</code>. Broken links or invalid paths will show an error/placeholder.</li>
                                    </ul>

                                    <h5>3. Code Snippets (Markdown Fenced Code Blocks)</h5>
                                     <ul>
                                        <li><strong>Form Editor Input (with actual newlines):</strong><br>
                                            <code>```python</code><br>
                                            <code>def greet():</code><br>
                                            <code>  print("Hi")</code><br>
                                            <code>```</code>
                                        </li>
                                        <li><strong>Raw JSON String Value (newlines escaped as `\\n`):</strong>
                                        <br><code>"```python\\ndef greet():\\n  print(\\"Hi\\")\\n```"</code>
                                        <br>(Note: If the code itself contains double quotes, those also need to be escaped as <code>\\"</code> within the JSON string value. If the code has backslashes, they'd be <code>\\\\</code>).
                                        </li>
                                        <li><strong>Preview:</strong> Renders with syntax highlighting using Prism.js. Ensure Prism.js is loaded and configured.</li>
                                    </ul>


                                    <h5>4. Chemical Content (Using mhchem via KaTeX)</h5>
                                    <ul>
                                        <li><strong>Form Editor / Raw JSON (same LaTeX rules as above):</strong>
                                            <br>Use LaTeX with `\ce{}` for chemical formulas. The included KaTeX version has the `mhchem` extension.
                                            <br>Example: <code>$\ce{H2O}$</code> or <code>$$\ce{CH4 + 2O2 -> CO2 + 2H2O}$$</code>
                                        </li>
                                        <li><strong>Raw JSON String for `\ce{H2O}`:</strong> <code>"$\\ce{H2O}$"</code></li>
                                        <li><strong>For very complex structures:</strong> Consider using Images (Markdown).</li>
                                         <li><strong>Preview:</strong> Renders using KaTeX with mhchem support.</li>
                                    </ul>
                                </div>
                                
                                <div class="tab-pane fade" id="help-common-errors-guide" role="tabpanel">
                                    <h4>Common Errors & Solutions (Primarily for Raw JSON Editing)</h4>
                                    <div class="accordion" id="errorsAccordionGuide">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#errorOneGuide">Invalid JSON Syntax / Parse Error</button></h2>
                                            <div id="errorOneGuide" class="accordion-collapse collapse show" data-bs-parent="#errorsAccordionGuide">
                                                <div class="accordion-body">
                                                    <p><strong>Problem:</strong> JSON structure is broken.</p>
                                                    <p><strong>Causes:</strong> Missing/extra commas, mismatched brackets/braces, unquoted keys (must be double-quoted), unquoted/single-quoted strings (must be double-quoted), unescaped special characters in strings (<code>"</code>, <code>\</code>, newlines).</p>
                                                    <p><strong>Tool Tip:</strong> "Validate JSON" in the JSON Editor tab often points to the error line. The linter in CodeMirror will also show red marks (ensure <code>jsonlint</code> script is loaded correctly before CodeMirror's JSON lint addon for this to work).</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errorTwoGuide">Validation Error: "Top level must be an array"</button></h2>
                                            <div id="errorTwoGuide" class="accordion-collapse collapse" data-bs-parent="#errorsAccordionGuide">
                                                <div class="accordion-body">
                                                    <p><strong>Problem:</strong> Content not enclosed in square brackets <code>[ ... ]</code>.</p>
                                                    <p><strong>Solution:</strong> Ensure JSON starts with <code>[</code> and ends with <code>]</code>. Even one question: <code>[ { /* question object */ } ]</code>.</p>
                                                </div>
                                            </div>
                                        </div>
                                         <div class="accordion-item">
                                            <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errorThreeGuide">Validation Error on a Specific Field</button></h2>
                                            <div id="errorThreeGuide" class="accordion-collapse collapse" data-bs-parent="#errorsAccordionGuide">
                                                <div class="accordion-body">
                                                    <p><strong>Problem:</strong> A field doesn't meet schema requirements (wrong type, missing, invalid value).</p>
                                                    <p><strong>Solution:</strong> Check the error message displayed by the validator. It usually indicates the question number and the problematic field. Refer to the "JSON Format" section in this help guide. Correct the data in the Form Editor or directly in the JSON Editor.</p>
                                                     <p><strong>Examples:</strong> <code>'question_number' must be unique.</code>, <code>'options' must have at least two key-value pairs.</code>, <code>'correct_answer' must match an option key.</code>, <code>'difficulty' must be "Easy", "Medium", or "Hard", or empty string if present.</code>, <code>'section_id' must be a non-empty string if present.</code></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errorFourGuide">Rich Content Not Rendering Correctly in Preview</button></h2>
                                            <div id="errorFourGuide" class="accordion-collapse collapse" data-bs-parent="#errorsAccordionGuide">
                                                <div class="accordion-body">
                                                    <p><strong>Problem:</strong> LaTeX, images, or code blocks look wrong in the Preview tab.</p>
                                                    <p><strong>Causes & Solutions:</strong></p>
                                                    <ul>
                                                        <li><strong>LaTeX:</strong> Invalid LaTeX syntax (e.g., mismatched braces, unknown commands). Missing <code>$</code> or <code>$$</code> delimiters. If editing raw JSON, ensure backslashes in LaTeX commands are properly escaped (e.g., <code>\frac</code> becomes <code>\\frac</code> in the JSON string). Check browser console for "KaTeX auto-render not available" or specific KaTeX parse errors.</li>
                                                        <li><strong>Images:</strong> Incorrect Markdown syntax (<code>![alt](url)</code>). Broken image URL (check if it loads in a browser). For relative paths, ensure they are correct with respect to the GitHub repository structure (e.g., <code>ExamName/assets/image.png</code>). HTTP URLs are blocked; use HTTPS.</li>
                                                        <li><strong>Code Blocks:</strong> Incorrect Markdown fenced code block syntax (<code>```lang ... ```</code>). If editing raw JSON, ensure newlines within the code are escaped as <code>\\n</code>. Ensure Prism.js scripts are loaded.</li>
                                                    </ul>
                                                    <p><strong>Tool Tip:</strong> The Form Editor is generally easier for rich content as it handles some escaping. Double-check the "Rich Content Formatting" section in this guide. Use browser developer tools (Console) to check for KaTeX or image loading errors related to the preview.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="help-ai-generation-guide" role="tabpanel">
                                     <h4>Using AI to Generate Question JSON</h4>
                                     <p>AI models can assist in drafting questions, but their output requires careful review and validation. Use a precise prompt to guide the AI.</p>
                                     <h5>Example AI Prompt:</h5>
                                     <p>Modify <code>[Number]</code> and <code>[Exam Name/Subject]</code> as needed. <strong>Emphasize the image path format for relative images.</strong></p>
                                     <div class="code-block bg-light p-3 rounded">
<pre><code class="language-text">Generate a valid JSON array containing [Number] practice questions for the [Exam Name/Subject] exam.

Each question object in the array must strictly follow this structure:
{
  "question_number": Number, // REQUIRED: Unique, sequential integer starting from 1
  "question_text": String,   // REQUIRED: Question text
  "options": Object,         // REQUIRED: e.g., {"a": "Option A", "b": "Option B"}
  "correct_answer": String,  // REQUIRED: Key matching the correct option (e.g., "b")
  "subject": String | null,    // Optional: e.g., "Physics" or null
  "topic": String | null,      // Optional: e.g., "Kinematics" or null
  "explanation": String | null, // Optional but preferred: Detailed explanation or null
  "difficulty": String | null, // Optional: "Easy", "Medium", or "Hard", or null/empty string
  "section_id": String | null  // Optional: e.g., "SectionA" or null
}

Formatting Rules for ALL String Values (This is for the raw JSON string value):
1.  Use LaTeX for Math: Inline `$ ... $`, Display `$$ ... $$`. IMPORTANT: Escape all LaTeX backslashes as `\\` (e.g., for `\frac`, use `\\frac` in the JSON string. For `\alpha`, use `\\alpha`).
2.  Use Markdown Code Blocks: Fenced ```language ... ```. IMPORTANT: Escape all newlines within the code portion of the string as `\\n`. Escape double quotes within the code as `\\"`.
3.  Use Markdown Images: `![Alt Text](URL_or_RELATIVE_PATH)`.
    - For HTTPS URLs: `![Diagram](https://example.com/image.png)`
    - For relative paths (for images in the 'Samkarya/online-exam-questions' GitHub repo): `![Chart](NIMCET/assets/my_chart.png)` (The tool will resolve this). Use a placeholder like `assets/image_placeholder.png` if the actual path isn't known yet.

Here is ONE example object showing these rules in the JSON string values:
{
  "question_number": 1,
  "subject": "Mathematics",
  "topic": "Algebra",
  "difficulty": "Easy",
  "section_id": "AlgebraBasics",
  "question_text": "If $x + 5 = 12$, what is the value of $x$?", // Note: $ is fine, no escaping for it.
  "options": { "a": "5", "b": "7", "c": "12", "d": "17" },
  "correct_answer": "b",
  "explanation": "Subtract 5 from both sides: $x + 5 - 5 = 12 - 5 \\\\implies x = 7$. Note the \\\\implies for \\implies."
}
Another example with code and image placeholder:
{
  "question_number": 2,
  "subject": "Programming",
  "topic": "Python",
  "difficulty": "Medium",
  "question_text": "What is the output of this Python code?\\n```python\\ndef main():\\n  print(\\"Hello, AI!\\")\\nmain()\\n```\\nAnd see this diagram: ![Placeholder](assets/diagram_todo.png)",
  "options": { "a": "Hello, AI!", "b": "Error" },
  "correct_answer": "a",
  "explanation": "The code defines and calls `main()`, which prints the string. Note `\\n` for newlines and `\\"` for quotes within the JSON string."
}

Generate [Number] question objects in a single valid JSON array, applying all rules, especially escaping for raw JSON string values. Ensure the final output is ONLY the JSON array itself, starting with '[' and ending with ']'.</code></pre>
                                     </div>
                                     <h5 class="mt-3">Post-AI Steps (Crucial):</h5>
                                     <ol>
                                         <li><strong>Import & Validate JSON:</strong> Use the "Import" feature and then "Validate JSON" / "Validate Form Data" button in this editor.</li>
                                         <li><strong>Verify Content:</strong> Check accuracy of questions, options, answers, and explanations.</li>
                                         <li><strong>Check Escaping (in Raw JSON view):</strong> Ensure LaTeX backslashes are <code>\\</code>, code newlines are <code>\\n</code>, and internal quotes are <code>\\"</code>.</li>
                                         <li><strong>Add/Verify Images:</strong> If using image placeholders or relative paths, ensure images are uploaded to the correct location in the <code>Samkarya/online-exam-questions</code> GitHub repository (e.g., <code>NIMCET/assets/</code> or a general <code>assets/</code> folder at the repo root) and update the paths in the JSON if needed. Test in the Preview tab.</li>
                                         <li><strong>Review `question_number`:</strong> Ensure they are unique and sequential. The editor can help re-sort if needed, but good initial data is better.</li>
                                     </ol>
                                 </div>

                                <div class="tab-pane fade" id="help-templates-guide" role="tabpanel">
                                    <h4>Using Templates</h4>
                                    <p>Templates provide pre-filled question structures to help you get started quickly and ensure correct formatting.</p>
                                    
                                    <h5>How to Use Templates</h5>
                                    <ol>
                                        <li>Go to the "Templates" tab in the sidebar.</li>
                                        <li>Select a category.</li>
                                        <li>Click on a template button (e.g., "Simple MCQ").</li>
                                        <li>Confirm if you want to "Replace" current content or "Append" the template to existing questions.</li>
                                        <li>The editor will update with the template data. Modify the content as needed using the Form Editor.</li>
                                    </ol>
                                    
                                    <h5>Available Template Categories</h5>
                                    <ul>
                                        <li><strong>Basic Templates:</strong> Simple MCQs, with/without explanations.</li>
                                        <li><strong>Subject-specific Templates:</strong> Examples for subjects like Mathematics or Physics.</li>
                                        <li><strong>Complex Content Templates:</strong> Demonstrates LaTeX, Markdown images (with relative paths), and code blocks.</li>
                                    </ul>
                                    
                                    <div class="alert alert-info mt-3">
                                        <i class="fas fa-lightbulb me-2"></i>
                                        <strong>Tip:</strong> Templates are excellent for learning the correct JSON structure and rich content formatting. Examine them in the JSON Editor tab after loading.
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="help-import-export-guide" role="tabpanel">
                                    <h4>Importing and Exporting JSON</h4>
                                    <p>Easily load existing Examify JSON files or save your work.</p>

                                    <h5>Importing JSON</h5>
                                    <ol>
                                        <li>Click the "Import" button in the top navbar.</li>
                                        <li>A modal will appear. Choose your import method:
                                            <ul>
                                                <li><strong>Import from file:</strong> Drag & drop a <code>.json</code> file onto the designated area, or click it to browse your computer.</li>
                                                <li><strong>Paste JSON:</strong> Select this option and paste your raw JSON text into the textarea.</li>
                                            </ul>
                                        </li>
                                        <li>Click the "Import" button in the modal.</li>
                                        <li>The editor will attempt to parse and validate the JSON data against the Examify schema.</li>
                                        <li>If successful, the Form Editor and JSON Editor tabs will be populated with the imported questions. A success message will appear.</li>
                                        <li>If there are errors (e.g., invalid JSON syntax or schema violations), an error message will detail the issues. You may need to correct the source JSON and try importing again.</li>
                                    </ol>

                                    <h5>Exporting JSON</h5>
                                    <ol>
                                        <li>Ensure your questions are complete and ideally validated (use "Validate Form Data" or "Validate JSON").</li>
                                        <li>Click the "Export" button in the top navbar.</li>
                                        <li>An export modal will appear:
                                            <ul>
                                                <li>(Optional) Change the default <strong>File Name</strong> (e.g., <code>my_exam_questions.json</code>).</li>
                                                <li>(Optional) Uncheck "Pretty format (indented) JSON" if you need a minified (compact, no extra spaces/newlines) JSON file. For Examify, pretty-formatted is usually fine and easier to read manually.</li>
                                            </ul>
                                        </li>
                                        <li>Click the "Export" button in the modal. Your browser will download the generated JSON file.</li>
                                    </ol>
                                    <div class="alert alert-warning mt-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Important:</strong> While the editor tries to ensure valid data, always double-check critical exams. Invalid JSON or content that doesn't render as expected in the Preview tab may cause issues on the Examify platform.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close Guide</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import JSON</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Select Import Method</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="importMethod" id="importFileRadio" value="file" checked>
                            <label class="form-check-label" for="importFileRadio">
                                Import from file
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="importMethod" id="importPasteRadio" value="paste">
                            <label class="form-check-label" for="importPasteRadio">
                                Paste JSON
                            </label>
                        </div>
                    </div>
                    
                    <div id="importFileSection">
                        <div class="dropzone" id="dropzoneArea">
                            <i class="fas fa-file-upload fa-2x mb-2 text-secondary"></i>
                            <p>Drag & drop a JSON file here or click to browse</p>
                            <input type="file" id="fileInput" accept=".json,application/json" style="display: none;">
                            <small id="dropzoneFileName" class="text-muted"></small>
                        </div>
                    </div>
                    
                    <div id="importPasteSection" style="display: none;">
                        <div class="mb-3">
                            <label for="pasteJsonTextarea" class="form-label">Paste JSON Content</label>
                            <textarea class="form-control" id="pasteJsonTextarea" rows="10" placeholder="Paste your JSON array here..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="importJsonBtn">Import</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">Export JSON</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="fileNameInput" class="form-label">File Name</label>
                        <input type="text" class="form-control" id="fileNameInput" value="examify_questions.json">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Format Options</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="formatJsonCheckbox" checked>
                            <label class="form-check-label" for="formatJsonCheckbox">
                                Pretty format (indented) JSON
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmExportBtn">Export</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Modal (Generic) -->
    <div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 id="loadingModalTitle">Processing...</h5>
                    <p id="loadingModalText" class="mb-0 text-muted">Please wait.</p>
                </div>
            </div>
        </div>
    </div>

        <!-- Bootstrap JS Bundle (Popper.js included) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/js/bootstrap.bundle.min.js"></script>
        <!-- CodeMirror JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js"></script>
        
        <!-- IMPORTANT: jsonlint.min.js MUST be loaded BEFORE CodeMirror's json-lint.js addon -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.3/jsonlint.min.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/lint/lint.min.js"></script>
        
        
        <!-- Toastify JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.js"></script>
        <!-- KaTeX JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/katex/0.16.9/katex.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/katex/0.16.9/contrib/auto-render.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/katex/0.16.9/contrib/mhchem.min.js"></script>
    
        <!-- Marked.js (Markdown parser) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.2/marked.min.js"></script>
        <!-- DOMPurify (Security for Markdown rendering) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
        <!-- Prism.js JS (core and autoloader for languages) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" data-manual></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/lint/json-lint.min.js"></script>
        <!-- Custom Script -->
        <script src="script.js" defer></script>
</body>
</html>